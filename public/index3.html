<html>
    <head>
        <title>Magicbox dashboard</title>

        <script>

	function _getData(url,data,callback){
		$.ajax({
			url: url,
		    type: 'POST',
		    contentType:"application/json;charset=UTF-8",
		    data: JSON.stringify(data)
		}).done(function (data) {    
		    callback(data);
		}).fail(function(jqXHR, textStatus, errorThrown){
		    log.v(TAG,"Error en AJAX _postProfileUpdate " + textStatus);
		    callback(errorThrown);
		});     
	}

	function randomColorFactor(){
		return Math.round(Math.random()*255);
	};

	function pad (str, max) {
		str = str.toString();
 		return str.length < max ? pad("0" + str, max) : str;
	};

        	var d = new Date();
		    var myConfig={
		    	"conn":{
		    		"url":"http://192.168.1.146:3002/api/v1/getConnects",
		    		"params":{
						"scope": "d",
			    		"type":"range",
						"from": "06-16-2015",
						"to": "06-16-2015",
			    		"app":{
			    			"name":"CVTEPortal",
			    			"version":"*"
			    		},  
						"metadata": {
						}
		    		}
		    	},
		    	"layout":{
		    		"container":"myContainer",
		    		"type":"Line",
    				"width":"400",
    				"height":"400",
    				"legend":"Connected devices (day view)",
    				"dataTable": false
		    	}
			}
		    var myConfig2={
		    	"conn":{
		    		"url":"http://192.168.1.146:3002/api/v1/getExecutions",
		    		"params":{
						"scope": "m",
			    		"type":"range",
						"from": "06-16-2015",
						"to": "06-16-2015",
			    		"app":{
			    			"name":"CVTEPortal",
			    			"version":"*"
			    		},  
						"metadata": {
						}
		    		}
		    	},
		    	"layout":{
		    		"container":"myContainer",
		    		"type":"Line",
    				"width":"400",
    				"height":"400",
    				"legend":"Connected devices (month view)"		    		
		    	}
			}
		    var myConfig3={
		    	"conn":{
		    		"url":"http://192.168.1.146:3002/api/v1/getExecutions",
		    		"params":{
						"scope": "y",
			    		"type":"range",
						"from": "06-16-2015",
						"to": "06-16-2015",
			    		"app":{
			    			"name":"CVTEPortal",
			    			"version":"*"
			    		},  
						"metadata": {
						}
		    		}
		    	},
		    	"layout":{
		    		"container":"myContainer",
		    		"type":"Bar",
    				"width":"400",
    				"height":"400",
    				"legend":"Connected devices (year view)"		    		
		    	}
			}
		    var myConfig4={
		    	"conn":{
		    		"url":"http://localhost:3002/api/v1/getExecutions",
		    		"params":{
						"scope": "y",
			    		"type":"range",
						"from": "06-16-2015",
						"to": "06-16-2015",
			    		"app":{
			    			"name":"CVTEPortal",
			    			"version":"*"
			    		},  
						"metadata": {
						}
		    		}
		    	},
		    	"layout":{
		    		"container":"myContainer",
		    		"type":"Pie",
    				"width":"400",
    				"height":"400",
    				"legend":"Connected devices (year view)"		    		
		    	}
			}			
			var myChart;
			var myChart2;
			var myChart3;
			var myChart4;
			var chartTest;
        	function init(){
        		_getData(myConfig.conn.url,myConfig.conn.params,_makeChart)
        	}


        	function _makeChart(data){
        		var myData=_makeChartData(data);
        		myChart=new magicbox.magicChart();
        		myChart.init(myData,myConfig);
        	}


        	function _addDataset(){
        		var chartTest=myChart.getChart();
		        var dataset={};
		        dataset.label="New";
				dataset.fillColor= "rgba("+randomColorFactor()+","+randomColorFactor()+","+randomColorFactor()+",0.5)";
				dataset.strokeColor= "rgba("+randomColorFactor()+","+randomColorFactor()+","+randomColorFactor()+",0.8)";
				dataset.highlightFill= "rgba("+randomColorFactor()+","+randomColorFactor()+","+randomColorFactor()+",0.75)";
				dataset.highlightStroke= "rgba("+randomColorFactor()+","+randomColorFactor()+","+randomColorFactor()+",1)";
	       		dataset.data=[];
	       		for (var i=0;i<=23;i+=1){
	       			dataset.data.push(34);
	       		}
	       		chartTest.datasets.push(dataset);
	       		chartTest.update();        		
        	}



			function _makeChartData(json){
		        var myJSON=json.data;
		        var myMetadata=json.metadata;
		        var _chartDataItem;

		   		var max;


		   		if (myMetadata.scope==="d"){
		   			max=23;
		   		}else if (myMetadata.scope==="m"){
		   			max=30;
		   		}else if (myMetadata.scope==="y"){
		   			max=11;
		   		};

		   		if (myConfig.layout.type==="Line" || myConfig.layout.type==="Bar"){
		   			_chartDataItem={};
		        	_chartDataItem.labels=[];
		        	_chartDataItem.datasets=[];
			        for (var i=0;i<=max;i+=1){
			        	_chartDataItem.labels.push(i)
			        }


			       	for (var k=0,maxk=myJSON.length;k<maxk;k+=1){
				        var dataset={};
				        dataset.label="New";
						dataset.fillColor= "rgba("+randomColorFactor()+","+randomColorFactor()+","+randomColorFactor()+",0.5)";
						dataset.strokeColor= "rgba("+randomColorFactor()+","+randomColorFactor()+","+randomColorFactor()+",0.8)";
						dataset.highlightFill= "rgba("+randomColorFactor()+","+randomColorFactor()+","+randomColorFactor()+",0.75)";
						dataset.highlightStroke= "rgba("+randomColorFactor()+","+randomColorFactor()+","+randomColorFactor()+",1)";
			       		dataset.data=[];
			       		for (var i=0;i<=max;i+=1){
			       			dataset.data.push(myJSON[k][pad(i,2)])
			       		}
			       		_chartDataItem.datasets.push(dataset);
			       	}
			    }
			    else if (_config.layout.type==="Pie" || _config.layout.type==="Doughnut"){
			    	_chartDataItem=[];
			        for (var i=0;i<=max;i+=1){
			        	var _dataItem={};
			        	_dataItem.label=i;
			        	_dataItem.hihglight="rgba("+randomColorFactor()+","+randomColorFactor()+","+randomColorFactor()+",0.5)";
			        	_dataItem.color="rgba("+randomColorFactor()+","+randomColorFactor()+","+randomColorFactor()+",1)";
			        	_dataItem.value=myJSON[0][pad(i,2)];
			        	_chartDataItem.push(_dataItem);	
			        }	    	
			    }
			    if (myConfig.layout.dataTable){
			    	_makeDataTable(myJSON[0]);
			    }

			    return _chartDataItem
				//_render(_chartDataItem);
			}        	
        </script>
    </head>
<body onload="init()">
<h1>Real Time Monitoring</h1>

<a href="javascript:_addDataset()">Add dataset</a>

<div id="myContainer">

</div>
<div id="myContainer2"></div>
<div id="myContainer3"></div>

<script type="text/javascript" src="app/javascript/vendors/jquery-1.7.js"></script>

<script type="text/javascript" src="app/javascript/vendors/Chart.js"></script>
<script type="text/javascript" src="app/javascript/magicbox.chart.js"></script>
<script type="text/javascript" src="app/javascript/magicbox.stats.config.js"></script>


</body>
</html>